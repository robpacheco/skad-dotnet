using System;
using System.Collections.Generic;
using System.Linq;
using Skad.VulnFeed.Data.Model;
using Skad.VulnFeed.MvcControllers.ViewModels;

namespace Skad.VulnFeed.MvcControllers.Extensions
{
    public static class VulnerabilityFeedIndexModelExtensions
    {
        public static VulnerabilityFeedItem ToVulnerabilityFeedItem(this VulnerableComponentSummary summary)
        {
            return new VulnerabilityFeedItem(
                summary.Vulnerability.CveId,
                summary.Component.ComponentName,
                AffectedVersionString(summary),
                summary.Vulnerability.ScoreCvss2,
                summary.Vulnerability.SeverityCvss2,
                summary.Vulnerability.ScoreCvss3,
                summary.Vulnerability.SeverityCvss3);
        }

        private static string AffectedVersionString(VulnerableComponentSummary summary)
        {
            if (summary.VulnerableVersionCount - 1 > 0)
            {
                return $"{summary.LatestVulnerableVersionName} (+ {summary.VulnerableVersionCount - 1} versions)";
            }

            return summary.LatestVulnerableVersionName;
        }
    }
}