CREATE TABLE public.vulnerability (
    vulnerability_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cve_id text NOT NULL,
    description text NOT NULL,
    score_cvss2 numeric(3, 1),
    severity_cvss2 text,
    score_cvss3 numeric(3, 1),
    severity_cvss3 text
);

CREATE UNIQUE INDEX vuln_cve_id_idx ON public.vulnerability (cve_id);

CREATE TABLE public.component (
    component_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    component_cpe text NOT NULL,
    component_name text
);

CREATE UNIQUE INDEX comp_component_cpe_idx ON public.component (component_cpe);

CREATE TABLE public.vulnerable_component_summary (
    vulnerable_component_summary_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    vulnerability_id bigint NOT NULL references vulnerability(vulnerability_id),
    component_id bigint NOT NULL references component(component_id),
    latest_vulnerable_version_name text,
    vulnerable_version_count int
);

CREATE TABLE public.vulnerability_feed_component (
    vulnerability_feed_component_id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    component_id bigint NOT NULL references component(component_id)
);
